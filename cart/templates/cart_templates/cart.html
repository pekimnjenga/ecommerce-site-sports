{% extends "app_templates/base.html" %}
{% block title %}<title>My Cart</title>{% endblock title %}
{% block content %}
{% load static %}

<div class="container my-5">
  <h2 class="mb-4">ðŸ›’ My Cart</h2>

  {% if cart_items %}
  {% for entry in cart_items %}
    <div class="card mb-3 p-3 d-flex align-items-center">
     {% if entry.item.images.count > 0 %}
     <img src="{{ entry.item.images.first.image_url }}" alt="{{ entry.item.name }}" class="me-3 rounded" width="100" height="100">
     {% else %}
     <img src="{% static 'app_templates/images/default.png' %}" alt="{{ entry.item.name }}" class="me-3 rounded" width="100" height="100">
     {% endif %}

      <div class="flex-grow-1">
        <p><strong>Item:</strong> {{ entry.item.name }}</p>
        {% if entry.size %}
        <p><strong>Size:</strong> {{ entry.size }}</p>
        {% endif %}
        <p><strong>Quantity:</strong> {{ entry.quantity }}</p>
        <p><strong>Amount:</strong> Ksh {{ entry.amount }}</p>

        <div class="btn-group mt-2" role="group">
          <form method="post" action="{% url 'add_to_cart' entry.item.id %}" style="display:inline;">
            {% csrf_token %}
            <input type="hidden" name="quantity" value="{{ entry.quantity }}">
            <input type="hidden" name="action" value="increase">
            <button type="submit" class="btn btn-outline-success">+</button>
          </form>

          <form method="post" action="{% url 'add_to_cart' entry.item.id %}" style="display:inline;">
            {% csrf_token %}
            <input type="hidden" name="quantity" value="{{ entry.quantity }}">
            <input type="hidden" name="action" value="decrease">
            <button type="submit" class="btn btn-outline-warning">âˆ’</button>
          </form>

          {% if entry.item.id %}
          <form method="POST" action="{% url 'remove_from_cart' entry.item.id %}">
            {% csrf_token %}
            {% if entry.size %}
            <input type="hidden" name="size" value="{{ entry.size }}">
            {% endif %}
            <input type="hidden" name="action" value="remove">
            <button type="submit" class="btn btn-danger btn-sm">Remove</button>
          </form>
          {% endif %}

        </div>
      </div>
    </div>
    
  {% endfor %}
  <h4 class="mt-4">ðŸ§¾ <strong>Total:</strong> Ksh {{ total }}</h4>

    <hr class="my-4">
    <div class="payment-card">
      <h4 class="payment-title">ðŸ“± M-PESA Payment</h4>
      <div class="payment-instructions">
        <p>Enter your M-PESA number in the format <strong>07XXXXXXXX</strong></p>
        <p>Click <strong>Purchase</strong> to receive a PIN prompt on your phone</p>
        <p>Once your payment is successful, you'll be redirected to another page indicating the success of your payment</p>
      </div>
      
      <form method="post">
        {% csrf_token %}
        {{ form.non_field_errors }}
        <div class="mb-3">
          {{ form.phone_number.label_tag }}
          {{ form.phone_number }}
        </div>
        <div class="mb-3">
          {{ form.address.label_tag }}
          {{ form.address }}
        </div>
        <button type="submit" class="btn btn-success w-100">Purchase</button>
      </form>
    </div>


  {% else %}
    <h5 class="mt-4">Your cart is empty.</h5>
  {% endif %}

</div>

{% endblock content %}
